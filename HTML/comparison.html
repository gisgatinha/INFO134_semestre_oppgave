<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../css/style.css" type="text/css">
    <link rel="stylesheet" href="../css/comparison.css" type="text/css">
    <title>Assignment</title>
</head>

<body onload="load()">

    <!--Menyen-->
    <div class="nav">
        <a href="introduction.html">Introduksjon</a>
        <a href="overview.html">Oversikt</a>
        <a href="details.html">Detaljer</a>
        <a class="active" href="comparison.html">Sammenligning</a>
    </div>


    <div>
        <!--Sidetekst, inputfelt som brukes i til å skaffe input til tabellene-->
        <div class="header innhold" id="kommunesammenligning">
            <br>
            <h1>Kommunesammenligning!</h1>
            <p>
                Her kan du sammenligne to kommuner, og sjekke hvilken av de som har best statistikk for
                utdanning!
                <br>
                Resultatene viser den prosentvise andelen i hver kommune.
            </p>
            <p>Skriv inn et gyldig kommunenummer i hvert felt for å komme i gang.</p>

            <!--Tabell for søk-->
            <div id="søkInnhold">
                <table id="søk">
                    <tr>
                        <th>Kommune 1</th>
                        <th>Kommune 2</th>
                    </tr>
                    <tr>
                        <td><input type="text" id="input1" onfocus="this.value=''" value="Kommune 1:"></td>
                        <td><input type="text" id="input2" onfocus="this.value=''" value="Kommune 2:"></td>
                    </tr>
                    <tr>
                        <th><label for="year-select">Årstall:</label></th>
                        <th><label for="gender-select">kjønn:</label></th>

                    </tr>
                    <tr>
                        <td>
                            <select id="year-select">
                                <option value="1970">1970</option>
                                <option value="1980">1980</option>
                                <option value="1981">1981</option>
                                <option value="1982">1982</option>
                                <option value="1983">1983</option>
                                <option value="1984">1984</option>
                                <option value="1985">1985</option>
                                <option value="1986">1986</option>
                                <option value="1987">1987</option>
                                <option value="1988">1988</option>
                                <option value="1989">1989</option>
                                <option value="1990">1990</option>
                                <option value="1991">1991</option>
                                <option value="1992">1992</option>
                                <option value="1993">1993</option>
                                <option value="1994">1994</option>
                                <option value="1995">1995</option>
                                <option value="1996">1996</option>
                                <option value="1997">1997</option>
                                <option value="1998">1998</option>
                                <option value="1999">1999</option>
                                <option value="2000">2000</option>
                                <option value="2001">2001</option>
                                <option value="2002">2002</option>
                                <option value="2003">2003</option>
                                <option value="2004">2004</option>
                                <option value="2005">2005</option>
                                <option value="2006">2006</option>
                                <option value="2007">2007</option>
                                <option value="2008">2008</option>
                                <option value="2009">2009</option>
                                <option value="2010">2010</option>
                                <option value="2011">2011</option>
                                <option value="2012">2012</option>
                                <option value="2013">2013</option>
                                <option value="2014">2014</option>
                                <option value="2015">2015</option>
                                <option value="2016">2016</option>
                                <option selected value="2017">2017</option>
                            </select>
                        </td>
                        <td>
                            <select id="gender-select">
                                <option value="Kvinner">Kvinner</option>
                                <option value="Menn">Menn</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2" style="text-align: center;">
                            <button type="button" id="søkeKnapp" onclick="search()">Sammenlign!</button>
                        </td>
                    </tr>
                </table>
            </div>

        </div>
        <div id="resultater"></div>
        <br>
        <br>
    </div>

    <!--Div som holder de to tabellene-->
    <div id="tableDiv" class="innhold">

        <!--Tabell 1-->
        <div id="table1">
            <table>
                <thead>
                    <tr>
                        <th colspan="2" height = 50px;>
                            <h3 id="kommune1table">Kommune: </h3>
                        </th>

                    </tr>
                </thead>

                <tbody>
                    <tr>
                        <td colspan="2" height=50px>
                            <h2 id="Vinner1"><h2>
                        </td>
                    </tr>
                    <tr id = "grunnskolekommune1">
                        <th>Grunnskolenivå: </th>
                        <td class="grunnskole kommune1"></td>
                    </tr>
                    <tr id = "videregåendekommune1">
                        <th>Videregående Nivå:</th>
                        <td class="vidergående kommune1"></td>
                    </tr>
                    <tr id = "fagskolekommune1">
                        <th>Fagskolenivå: </th>
                        <td class="fagskole kommune1"></td>
                    </tr>
                    <tr id = "unikortkommune1">
                        <th>Universitet-og-Høgskolenivå Kort:</th>
                        <td class="universitet_kort kommune1"></td>
                    </tr>
                    <tr id = "unilangkommune1">
                        <th>Universitet-og-Høgskolenivå Lang: </th>
                        <td class="universitet_lang kommune1"></td>
                    </tr>
                    <tr id = "uoppgittkommune1">
                        <th>Uoppgitt/Ikke Fullført: </th>
                        <td class="ukjent kommune1"></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!--Tabell 2-->
        <div id="table2">
            <table>
                <thead>
                    <tr>
                        <th colspan="2" height = 50px;>
                            <h3 id="kommune2table">Kommune: </h3>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="2" height=50px >
                            <h2 id="Vinner2"> <h2>
                        </td>
                    </tr>
                    <tr id = "grunnskolekommune2">
                        <th>Grunnskolenivå: </th>
                        <td class="grunnskole kommune2"></td>
                    </tr>
                    <tr id="videregåendekommune2">
                        <th>Videregående Nivå:</th>
                        <td class="vidergående kommune2"></td>
                    </tr>
                    <tr id ="fagskolekommune2">
                        <th>Fagskolenivå: </th>
                        <td class="fagskole kommune2"></td>
                    </tr>
                    <tr id = "unikortkommune2">
                        <th>Universitet-og-Høgskolenivå Kort:</th>
                        <td class="universitet_kort kommune2"></td>
                    </tr>
                    <tr id = "unilangkommune2">
                        <th>Universitet-og-Høgskolenivå Lang: </th>
                        <td class="universitet_lang kommune2"></td>
                    </tr>
                    <tr id = "uoppgittkommune2">
                        <th>Uoppgitt/Ikke Fullført: </th>
                        <td class="ukjent kommune2"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <br>
    </div>

    <footer class="footer">
        <div> Dette er en oppgavebesvarelse i INFO134 vår2020. </div>
    </footer>

    <script>
        //konstruktøren
        var Datasett = function(URL) {
            this.data = {}

            //laster inn datasettet
            this.loadIt = async function load() {
                const response = await fetch(URL);
                this.data = await response.json();
                console.log("KONSTRUKTØREN VIRKER!!!")

                if (typeof this.onload === "function")
                    this.onload()
            }
            //returnerer en liste av kommunenavn
            this.getNames = function() {
                var kommuneliste = Object.keys(this.data.elementer);
                return kommuneliste;
            }
            //returnerer en liste av kommunenummer
            this.getIDs = function() {
                var kommuner = Object.values(this.data.elementer);
                var IDer = kommuner.map((kommune) => kommune.kommunenummer);
                return IDer
            }
            this.getNameFromKommunenummer = function(kommunenummer) {
                var entry = Object.entries(this.data.elementer).find(entry => {
                    var kommunedata = entry[1]
                    return kommunedata.kommunenummer === kommunenummer
                })        
                var kommunenavn = entry[0]
                return kommunenavn
            }
            this.getKommunedata = function(kommunenummer) {
                var kommune = Object.values(this.data.elementer).find(k => k.kommunenummer === kommunenummer)
                return kommune
            }
        }

        //pil == funksjon
        //uten krøllparantes = no return, med = remember return

        var datasett = new Datasett("http://wildboy.uib.no/~tpe056/folk/85432.json")

        datasett.onload = function () {
            datasett.getNames()
            datasett.getIDs()
        }
        datasett.loadIt()

        function search() {
            //finner de første elementene med rett ID og henter ut verdien
            const input1 = document.querySelector("#input1").value;
            const input2 = document.querySelector("#input2").value;
            const arstall = document.querySelector("#year-select").value;
            const kjonn = document.querySelector("#gender-select").value;

            //setter verdien av kommune1 og kommune2
            const kommune1 = datasett.getKommunedata(input1);
            const kommune2 = datasett.getKommunedata(input2);
            //var kommune3 = window.data.elementer[input2].kommunenummer.value;

            const resultater = document.querySelector("#resultat");

            if ((!kommune1) || (!kommune2)) {
                alert ("En eller begge er ikke gyldig kommune! ");
                return
            }else{

                //Viser hvilke kommune som det vises
                document.querySelector("#kommune1table").textContent = "Kommune: " + datasett.getNameFromKommunenummer(input1);
                document.querySelector("#kommune2table").textContent = "Kommune: " + datasett.getNameFromKommunenummer(input2);


                //Regner ut vinner av de to kommunene og setter farge for å indikere størst andel
                var kommune1Poeng = 0
                var kommune2Poeng = 0


/*
                //Avgjør vinneren og printer dette
                var sum1 = Beregne_vinner(kommune1);
                var sum2 = Beregne_vinner(kommune2);
                if (sum1> sum2) {
                    document.querySelector("#Vinner1").textContent = "Vinner!!!";
                    document.querySelector("#Vinner2").textContent = "";
                } else if (sum2 > sum1) {
                    document.querySelector("#Vinner2").textContent = "Vinner!!!";
                    document.querySelector("#Vinner1").textContent = "";
                } else {
                    document.querySelector("#Vinner2").textContent = "Uavgjort";
                    document.querySelector("#Vinner1").textContent = "Uavgjort";

                }
*/
            function Beregne_vinner (kommune){
                var sum = kommune['11'][kjonn][arstall] + kommune1['03a'][kjonn][arstall] + kommune1['04a'][kjonn][arstall]
                return sum
            }
/*
            function Beregne_vinner (kommune){
                var sum = kommune['01'][kjonn][arstall] + kommune['02a'][kjonn][arstall] +
                kommune['11'][kjonn][arstall] + kommune1['03a'][kjonn][arstall] + kommune1['04a'][kjonn][arstall] +
                kommune1['09a'][kjonn][arstall]
                return sum
            }
*/
/*
                if (kommune1['01'][kjonn][arstall] > kommune2['01'][kjonn][arstall]) {
                    kommune1Poeng+=1;
                    document.getElementById("grunnskolekommune1").style.background="rgba(255, 255, 255, 0.25)";
                    document.getElementById("grunnskolekommune2").style.background="inherit";
                } 
            
                if (kommune1['01'][kjonn][arstall] < kommune2['01'][kjonn][arstall]) {
                    kommune2Poeng+=1;
                    document.getElementById("grunnskolekommune2").style.background="rgba(255, 255, 255, 0.25)";
                    document.getElementById("grunnskolekommune1").style.background="inherit";
                }
                if (kommune1['02a'][kjonn][arstall] > kommune2['02a'][kjonn][arstall]) {
                    kommune1Poeng+=1;
                    document.getElementById("videregåendekommune1").style.background="rgba(255, 255, 255, 0.25)";
                    document.getElementById("videregåendekommune2").style.background="inherit";
                }
                if (kommune1['02a'][kjonn][arstall] < kommune2['02a'][kjonn][arstall]) {
                    kommune2Poeng+=1
                    document.getElementById("videregåendekommune2").style.background="rgba(255, 255, 255, 0.25)";
                    document.getElementById("videregåendekommune1").style.background="inherit";
                }
*/
                if (kommune1['11'][kjonn][arstall] > kommune2['11'][kjonn][arstall]) {
                    kommune1Poeng+=1;
                    document.getElementById("fagskolekommune1").style.background="rgba(255, 255, 255, 0.25)";
                    document.getElementById("fagskolekommune2").style.background="inherit";
                }
                if (kommune1['11'][kjonn][arstall] < kommune2['11'][kjonn][arstall]) {
                    kommune2Poeng+=1;
                    document.getElementById("fagskolekommune2").style.background="rgba(255, 255, 255, 0.25)";
                    document.getElementById("fagskolekommune1").style.background="inherit";
                }

                if (kommune1['03a'][kjonn][arstall] > kommune2['03a'][kjonn][arstall]) {
                    kommune1Poeng+=1;
                    document.getElementById("unikortkommune1").style.background="rgba(255, 255, 255, 0.25)";
                    document.getElementById("unikortkommune2").style.background="inherit";
                }
                if (kommune1['03a'][kjonn][arstall] < kommune2['03a'][kjonn][arstall]) {
                    kommune2Poeng+=1;
                    document.getElementById("unikortkommune2").style.background="rgba(255, 255, 255, 0.25)";
                    document.getElementById("unikortkommune1").style.background="inherit";
                }

                if (kommune1['04a'][kjonn][arstall] > kommune2['04a'][kjonn][arstall]) {
                    kommune1Poeng+=1;
                    document.getElementById("unilangkommune1").style.background="rgba(255, 255, 255, 0.25)";
                    document.getElementById("unilangkommune2").style.background="inherit";
                }
                if (kommune1['04a'][kjonn][arstall] < kommune2['04a'][kjonn][arstall]) {
                    kommune2Poeng++
                    document.getElementById("unilangkommune2").style.background="rgba(255, 255, 255, 0.25)";
                    document.getElementById("unilangkommune1").style.background="inherit";
                }

                console.log(kommune2Poeng);
                console.log(kommune1Poeng);
            
                //Avgjør vinneren og printer dette

                if (kommune1Poeng> kommune2Poeng) {
                    document.querySelector("#Vinner1").textContent = "Vinner!!!";
                    document.querySelector("#Vinner2").textContent = "";
                } else if (kommune2Poeng > kommune1Poeng) {
                    document.querySelector("#Vinner2").textContent = "Vinner!!!";
                    document.querySelector("#Vinner1").textContent = "";
                } else {
                    document.querySelector("#Vinner2").textContent = "Uavgjort";
                    document.querySelector("#Vinner1").textContent = "Uavgjort";

                }
             



                //henter ut data fra datasettet. lag loop?
                document.querySelector(".grunnskole.kommune1").textContent = kommune1['01'][kjonn][arstall];
                document.querySelector(".vidergående.kommune1").textContent = kommune1['02a'][kjonn][arstall];
                document.querySelector(".fagskole.kommune1").textContent = kommune1['11'][kjonn][arstall];
                document.querySelector(".universitet_kort.kommune1").textContent = kommune1['03a'][kjonn][arstall];
                document.querySelector(".universitet_lang.kommune1").textContent = kommune1['04a'][kjonn][arstall];
                document.querySelector(".ukjent.kommune1").textContent = kommune1['09a'][kjonn][arstall];

                document.querySelector(".grunnskole.kommune2").textContent = kommune2['01'][kjonn][arstall];
                document.querySelector(".vidergående.kommune2").textContent = kommune2['02a'][kjonn][arstall];
                document.querySelector(".fagskole.kommune2").textContent = kommune2['11'][kjonn][arstall];
                document.querySelector(".universitet_kort.kommune2").textContent = kommune2['03a'][kjonn][arstall];
                document.querySelector(".universitet_lang.kommune2").textContent = kommune2['04a'][kjonn][arstall];
                document.querySelector(".ukjent.kommune2").textContent = kommune2['09a'][kjonn][arstall];
            }
    }
    </script>

</body>

</html>
